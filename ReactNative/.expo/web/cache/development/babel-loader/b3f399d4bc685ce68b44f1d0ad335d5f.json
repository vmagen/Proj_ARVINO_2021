{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\vmage\\\\OneDrive\\\\Ruppin\\\\\\u05E9\\u05E0\\u05D4 \\u05D2\\\\\\u05E1\\u05DE\\u05E1\\u05D8\\u05E8 \\u05D1\\\\Proj_July_RN\\\\FunctionalComponents\\\\FCRate.js\",\n    _this = this;\n\nimport React, { useContext, useState, useEffect } from 'react';\nimport { Rating } from 'react-native-ratings';\nimport View from \"react-native-web/dist/exports/View\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport TouchableWithoutFeedback from \"react-native-web/dist/exports/TouchableWithoutFeedback\";\nimport Keyboard from \"react-native-web/dist/exports/Keyboard\";\nimport { Text, Icon, Button } from 'react-native-elements';\nimport styleSheet from \"../Pages/PageStyle\";\nimport { AuthContext } from \"../Componenets/AuthContext\";\nimport FCHeader from \"./FCHeader\";\nimport headers from \"../helpers/messages.json\";\nimport { useNavigation } from '@react-navigation/native';\nimport helpers from \"../helpers/helperFunctions\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { PrefContext } from \"../Componenets/PrefrenceContext\";\nexport default function FCWineRate(props) {\n  var navigation = useNavigation();\n\n  var _useContext = useContext(AuthContext),\n      user = _useContext.user;\n\n  var _useContext2 = useContext(PrefContext),\n      AddToDB = _useContext2.AddToDB;\n\n  var _useState = useState(3),\n      _useState2 = _slicedToArray(_useState, 2),\n      rate = _useState2[0],\n      setRate = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      comment = _useState4[0],\n      setComment = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isAllowed = _useState6[0],\n      setIsAllowed = _useState6[1];\n\n  var numOfDaysAllowedToPost = 2;\n  useEffect(function () {\n    checkifUserAllowedToSubmit(user.email, props.route.params.wineId, numOfDaysAllowedToPost);\n  }, []);\n\n  var rateWine = function rateWine() {\n    try {\n      if (isAllowed) {\n        addCommenttoDB(user.email, comment, props.route.params.wineId);\n        var freeText = props.route.params.wineId + ',' + rate;\n        AddToDB(user.email, 2, freeText);\n      } else {\n        Alert.alert(\"User is not allowed to submit to same wine less than a week!\");\n      }\n    } catch (_unused) {\n      Alert.alert(\"CATCH error\");\n    }\n  };\n\n  var checkifUserAllowedToSubmit = function checkifUserAllowedToSubmit(email, wineId, days) {\n    var res, data;\n    return _regeneratorRuntime.async(function checkifUserAllowedToSubmit$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(fetch(helpers.getApi() + 'Rate/UserAllowed?wineId=' + wineId + '&email=' + email + '&days=' + days));\n\n          case 2:\n            res = _context.sent;\n            console.log(helpers.getApi() + 'Rate/UserAllowed?wineId=' + wineId + '&email=' + email + '&days=' + days);\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(res.json());\n\n          case 6:\n            data = _context.sent;\n\n            if (data == true) {\n              setIsAllowed(true);\n            }\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var addCommenttoDB = function addCommenttoDB(email, text, wineId) {\n    var newComment;\n    return _regeneratorRuntime.async(function addCommenttoDB$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            newComment = {\n              \"email\": email,\n              \"text\": text,\n              \"rate\": rate,\n              \"wineId\": wineId\n            };\n            console.log(newComment);\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(fetch(helpers.getApi() + '/Rate/PostComment', {\n              method: 'POST',\n              body: JSON.stringify(newComment),\n              headers: new Headers({\n                'Content-Type': 'application/json; charset=UTF-8',\n                'Accept': 'application/json; charset=UTF-8'\n              })\n            }).then(function (res) {\n              alert(\"comment published!\");\n              navigation.goBack();\n              return JSON.stringify(res);\n            }, function (error) {\n              alert(error);\n            }));\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var handleComment = function handleComment(val) {\n    setComment(val);\n  };\n\n  var handleRate = function handleRate(val) {\n    setRate(val);\n  };\n\n  return React.createElement(View, {\n    style: styleSheet.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 5\n    }\n  }, React.createElement(FCHeader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }\n  }), React.createElement(View, {\n    style: {\n      flexDirection: 'row'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }\n  }, React.createElement(Icon, {\n    style: {\n      flex: 1,\n      height: 50\n    },\n    onPress: function onPress() {\n      navigation.goBack();\n    },\n    reverse: true,\n    name: \"chevron-back-outline\",\n    type: \"ionicon\",\n    color: \"#691A1A\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }\n  }), React.createElement(Text, {\n    h4: true,\n    style: [styleSheet.h4Text, {\n      flex: 1\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }, headers.writeComment)), React.createElement(View, {\n    style: {\n      flexDirection: 'row',\n      alignItems: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }\n  }, React.createElement(View, {\n    style: {\n      flex: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }\n  }, React.createElement(Text, {\n    h4: true,\n    style: [styleSheet.h4Text],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 11\n    }\n  }, props.route.params.wineName), React.createElement(Text, {\n    h5: true,\n    style: {\n      textAlign: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 11\n    }\n  }, props.route.params.wineryname)), React.createElement(View, {\n    style: {\n      flex: 1,\n      marginLeft: 50\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, React.createElement(Image, {\n    source: {\n      uri: props.route.params.wineImg\n    },\n    style: [styleSheet.wine, {\n      height: 150\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 11\n    }\n  }))), React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }\n  }, React.createElement(Rating, {\n    showRating: false,\n    onFinishRating: function onFinishRating(rat) {\n      return handleRate(rat);\n    },\n    style: {\n      paddingVertical: 10\n    },\n    imageSize: 40,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  })), isAllowed && React.createElement(KeyboardAvoidingView, {\n    behavior: Platform.OS === \"ios\" ? \"padding\" : \"height\",\n    style: {\n      flex: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 9\n    }\n  }, React.createElement(TouchableWithoutFeedback, {\n    onPress: Keyboard.dismiss,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 11\n    }\n  }, React.createElement(View, {\n    style: {\n      padding: 10,\n      flex: 1,\n      justifyContent: \"space-around\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }\n  }, React.createElement(TextInput, {\n    placeholder: headers.writeComment,\n    style: {\n      height: 100,\n      borderColor: \"#000000\",\n      borderWidth: 1,\n      textAlign: 'right'\n    },\n    onChangeText: handleComment,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 15\n    }\n  }), React.createElement(View, {\n    style: {\n      backgroundColor: \"white\",\n      marginTop: 12\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 15\n    }\n  }, React.createElement(Button, {\n    title: headers.rate,\n    buttonStyle: styleSheet.button,\n    onPress: rateWine,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 17\n    }\n  }))))), !isAllowed && React.createElement(Text, {\n    h4: true,\n    style: styleSheet.h4Text,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 22\n    }\n  }, headers.rateAlert));\n}\nexport var FCRate = function FCRate(props) {\n  var _useState7 = useState(3),\n      _useState8 = _slicedToArray(_useState7, 2),\n      rate = _useState8[0],\n      setRate = _useState8[1];\n\n  var returnRate = function returnRate(rat) {};\n\n  return React.createElement(Rating, {\n    showRating: true,\n    onFinishRating: function onFinishRating(rat) {\n      setRate(rat);\n    },\n    style: {\n      paddingVertical: 10\n    },\n    imageSize: 30,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 5\n    }\n  });\n};","map":{"version":3,"sources":["C:/Users/vmage/OneDrive/Ruppin/שנה ג/סמסטר ב/Proj_July_RN/FunctionalComponents/FCRate.js"],"names":["React","useContext","useState","useEffect","Rating","Text","Icon","Button","styleSheet","AuthContext","FCHeader","headers","useNavigation","helpers","PrefContext","FCWineRate","props","navigation","user","AddToDB","rate","setRate","comment","setComment","isAllowed","setIsAllowed","numOfDaysAllowedToPost","checkifUserAllowedToSubmit","email","route","params","wineId","rateWine","addCommenttoDB","freeText","Alert","alert","days","fetch","getApi","res","console","log","json","data","text","newComment","method","body","JSON","stringify","Headers","then","goBack","error","handleComment","val","handleRate","container","flexDirection","flex","height","h4Text","writeComment","alignItems","wineName","textAlign","wineryname","marginLeft","uri","wineImg","wine","rat","paddingVertical","Platform","OS","Keyboard","dismiss","padding","justifyContent","borderColor","borderWidth","backgroundColor","marginTop","button","rateAlert","FCRate","returnRate"],"mappings":"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","sourcesContent":["import React, { useContext, useState, useEffect } from 'react'\r\nimport { Rating } from 'react-native-ratings';\r\nimport { View, Image, TextInput, KeyboardAvoidingView, TouchableWithoutFeedback, Keyboard } from 'react-native';\r\nimport { Text, Icon, Button } from 'react-native-elements';\r\nimport styleSheet from '../Pages/PageStyle';\r\nimport { AuthContext } from '../Componenets/AuthContext';\r\nimport FCHeader from './FCHeader';\r\nimport headers from '../helpers/messages.json';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport helpers from '../helpers/helperFunctions';\r\nimport { Alert } from 'react-native';\r\nimport { PrefContext } from '../Componenets/PrefrenceContext';\r\n\r\n\r\nexport default function FCWineRate(props) {\r\n\r\n  const navigation = useNavigation();\r\n  const { user } = useContext(AuthContext);\r\n  const { AddToDB } = useContext(PrefContext);\r\n  const [rate, setRate] = useState(3);\r\n  const [comment, setComment] = useState('');\r\n  const [isAllowed, setIsAllowed] = useState(false);\r\n\r\n  const numOfDaysAllowedToPost=2;\r\n\r\n  useEffect(() => {\r\n    checkifUserAllowedToSubmit(user.email, props.route.params.wineId, numOfDaysAllowedToPost);\r\n  }, [])\r\n\r\n  const rateWine = () => {\r\n    try {\r\n      if (isAllowed) {\r\n        addCommenttoDB(user.email, comment, props.route.params.wineId);\r\n        let freeText= props.route.params.wineId+','+ rate;\r\n        // console.log(freeText);\r\n        AddToDB(user.email, 2, freeText);\r\n      }\r\n      else {\r\n        Alert.alert(\"User is not allowed to submit to same wine less than a week!\")\r\n      }\r\n    }\r\n    catch {\r\n      Alert.alert(\"CATCH error\")\r\n    }\r\n  }\r\n\r\n  const checkifUserAllowedToSubmit = async (email, wineId, days) => {\r\n    const res = await fetch(helpers.getApi() + 'Rate/UserAllowed?wineId=' + wineId + '&email=' + email + '&days=' + days);\r\n    console.log(helpers.getApi() + 'Rate/UserAllowed?wineId=' + wineId + '&email=' + email + '&days=' + days);\r\n    const data = await res.json();\r\n    if (data == true) { setIsAllowed(true) }\r\n  }\r\n\r\n  const addCommenttoDB = async (email, text, wineId) => {\r\n    let newComment =\r\n    {\r\n      \"email\": email,\r\n      \"text\": text,\r\n      \"rate\": rate,\r\n      \"wineId\": wineId\r\n    };\r\n    console.log(newComment)\r\n\r\n    await fetch(helpers.getApi() + '/Rate/PostComment',\r\n      {\r\n        method: 'POST',\r\n        body: JSON.stringify(newComment),\r\n        headers: new Headers({\r\n          'Content-Type': 'application/json; charset=UTF-8',\r\n          'Accept': 'application/json; charset=UTF-8',\r\n        })\r\n      })\r\n      .then(res => {\r\n        alert(\"comment published!\");\r\n        navigation.goBack();\r\n\r\n        return JSON.stringify(res);\r\n      }, (error) => {\r\n        alert(error);\r\n      })\r\n  }\r\n\r\n  const handleComment = (val) => {\r\n    setComment(val);\r\n  };\r\n  const handleRate = (val) => {\r\n    setRate(val);\r\n  };\r\n\r\n  return (\r\n    <View style={styleSheet.container}>\r\n      <FCHeader />\r\n      <View style={{ flexDirection: 'row' }}>\r\n        <Icon\r\n          style={{ flex: 1, height: 50 }}\r\n          onPress={\r\n            () => {\r\n              navigation.goBack()\r\n            }\r\n          }\r\n          reverse\r\n          name='chevron-back-outline'\r\n          type='ionicon'\r\n          color='#691A1A'\r\n        />\r\n        <Text h4 style={[styleSheet.h4Text, { flex: 1 }]}>{headers.writeComment}</Text>\r\n      </View>\r\n      <View style={{ flexDirection: 'row', alignItems: 'center' }}>\r\n        <View style={{ flex: 1 }}>\r\n          <Text h4 style={[styleSheet.h4Text]}>{props.route.params.wineName}</Text>\r\n          <Text h5 style={{ textAlign: 'right' }}>{props.route.params.wineryname}</Text>\r\n        </View>\r\n        <View style={{ flex: 1, marginLeft: 50 }}>\r\n          <Image\r\n            source={{ uri: props.route.params.wineImg }}\r\n            style={[styleSheet.wine, { height: 150 }]} />\r\n        </View>\r\n      </View>\r\n      <View>\r\n        <Rating\r\n          showRating={false}\r\n          onFinishRating={(rat) => handleRate(rat)}\r\n          style={{ paddingVertical: 10 }}\r\n          imageSize={40}\r\n        />\r\n      </View>\r\n      {isAllowed &&\r\n        <KeyboardAvoidingView\r\n          behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n          style={{ flex: 1 }}\r\n        >\r\n          <TouchableWithoutFeedback onPress={Keyboard.dismiss}>\r\n            <View style={{ padding: 10, flex: 1, justifyContent: \"space-around\" }}>\r\n              <TextInput\r\n                placeholder={headers.writeComment}\r\n                style={{ height: 100, borderColor: \"#000000\", borderWidth: 1, textAlign: 'right' }}\r\n                onChangeText={handleComment}\r\n              />\r\n              <View style={{ backgroundColor: \"white\", marginTop: 12 }}>\r\n                <Button\r\n                  title={headers.rate}\r\n                  buttonStyle={styleSheet.button}\r\n                  onPress={rateWine}\r\n                />\r\n              </View>\r\n            </View>\r\n          </TouchableWithoutFeedback>\r\n        </KeyboardAvoidingView>}\r\n      {!isAllowed && <Text h4 style={styleSheet.h4Text}>{headers.rateAlert}</Text>}\r\n    </View>\r\n  )\r\n}\r\n\r\n\r\nexport const FCRate = (props) => {\r\n  const [rate, setRate] = useState(3);\r\n\r\n  const returnRate = (rat) => {\r\n\r\n  }\r\n\r\n  return (\r\n    <Rating\r\n      showRating\r\n      onFinishRating={(rat) => { setRate(rat) }}\r\n      style={{ paddingVertical: 10 }}\r\n      imageSize={30}\r\n    />\r\n  )\r\n}"]},"metadata":{},"sourceType":"module"}